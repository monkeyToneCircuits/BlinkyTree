;PlatformIO Project Configuration File
;
; ATtiny85 BlinkyTree Christmas Tree v2.0
; Clean configuration for ATtiny85 only - no native testing
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = attiny85_avrispv2

; ============================================================================
; DEBUG BUILD - Safe for development and testing
; ============================================================================

[env:attiny85_debug] 
platform = atmelavr
board = attiny85
board_build.f_cpu = 8000000L      ; 8MHz internal oscillator (ATtiny85)
build_type = debug
build_flags = 
    -Os                           ; Optimize for size
    -Wall -Wextra                ; Enable all warnings
    -mmcu=attiny85               ; Target ATtiny85
    -std=c99                     ; C99 standard
    -ffunction-sections          ; Dead code elimination
    -fdata-sections              
    -Wl,--gc-sections            ; Linker garbage collection
    -Iconfig                     ; Include config directory
    -DDEBUG_BUILD
    -DPLATFORM_ATTINY85
upload_protocol = arduino
upload_port = COM5
upload_speed = 19200
upload_flags = 
    -P$UPLOAD_PORT
    -b$UPLOAD_SPEED
board_fuses.lfuse = 0xE2        ; Internal RC 8MHz, CKDIV8 disabled = 8MHz
board_fuses.hfuse = 0xDF        ; Reset enabled, BOD 2.7V
board_fuses.efuse = 0xFF        ; Self-programming disabled

; ============================================================================
; DEBUG BUILD - Using Arduino as ISP (COM5)
; ============================================================================

[env:attiny85_arduinoisp]
platform = atmelavr
board = attiny85
board_build.f_cpu = 8000000L      ; 8MHz internal oscillator (ATtiny85)
build_type = debug
build_flags = 
    -Os                           ; Optimize for size
    -Wall -Wextra                ; Enable all warnings
    -mmcu=attiny85               ; Target ATtiny85
    -std=c99                     ; C99 standard
    -ffunction-sections          ; Dead code elimination
    -fdata-sections              
    -Wl,--gc-sections            ; Linker garbage collection
    -Iconfig                     ; Include config directory
    -DDEBUG_BUILD
    -DPLATFORM_ATTINY85
upload_protocol = stk500v1       ; ArduinoISP uses stk500v1 protocol
upload_port = COM5               ; Arduino Uno with ArduinoISP sketch
upload_speed = 19200
upload_flags = 
    -P$UPLOAD_PORT
    -b$UPLOAD_SPEED
board_fuses.lfuse = 0xE2        ; Internal RC 8MHz, CKDIV8 disabled = 8MHz
board_fuses.hfuse = 0xDF        ; Reset enabled, BOD 2.7V
board_fuses.efuse = 0xFF        ; Self-programming disabled

; ============================================================================
; DEBUG BUILD - Using AVRISPv2 (COM6)
; ============================================================================

[env:attiny85_avrispv2]
platform = atmelavr
board = attiny85
board_build.f_cpu = 8000000L      ; 8MHz internal oscillator (ATtiny85)
build_type = debug
build_flags = 
    -Os                           ; Optimize for size
    -Wall -Wextra                ; Enable all warnings
    -mmcu=attiny85               ; Target ATtiny85
    -std=c99                     ; C99 standard
    -ffunction-sections          ; Dead code elimination
    -fdata-sections              
    -Wl,--gc-sections            ; Linker garbage collection
    -Iconfig                     ; Include config directory
    -DDEBUG_BUILD
    -DPLATFORM_ATTINY85
upload_protocol = avrispv2       ; AVRISPv2 programmer
upload_port = COM6
upload_speed = 19200
upload_flags = 
    -P$UPLOAD_PORT
    -b$UPLOAD_SPEED
board_fuses.lfuse = 0xE2        ; Internal RC 8MHz, CKDIV8 disabled = 8MHz
board_fuses.hfuse = 0xDF        ; Reset enabled, BOD 2.7V
board_fuses.efuse = 0xFF        ; Self-programming disabled


; ============================================================================
; RELEASE BUILD - Production firmware with RESET pin disabled
; ============================================================================

[env:attiny85_release]
; ⚠️  WARNING: PRODUCTION BUILD - RESET PIN DISABLED! ⚠️
; Programming via ISP will NOT be possible after flashing!
; Use this only for final production units!
platform = atmelavr
board = attiny85
board_build.f_cpu = 8000000L      ; 8MHz internal oscillator (ATtiny85)
build_type = release
build_flags = 
    -Os                           ; Optimize for size
    -Wall -Wextra                ; Enable all warnings
    -mmcu=attiny85               ; Target ATtiny85
    -std=c99                     ; C99 standard
    -ffunction-sections          ; Dead code elimination
    -fdata-sections              
    -Wl,--gc-sections            ; Linker garbage collection
    -flto                        ; Link-time optimization
    -Iconfig                     ; Include config directory
    -DPRODUCTION_BUILD           ; Production build flag
    -DPLATFORM_ATTINY85
    -DNDEBUG                     ; Disable debug assertions
    -DRESET_PIN_AS_IO            ; Use reset pin as GPIO for LED_3ER
upload_protocol = avrispv2
upload_port = COM6
upload_speed = 19200
board_fuses.lfuse = 0xE2        ; Internal RC 8MHz, CKDIV8 disabled = 8MHz
board_fuses.hfuse = 0x5F        ; Reset DISABLED (0x5F), BOD 2.7V - ENABLES PB5 as GPIO!
board_fuses.efuse = 0xFF        ; Self-programming disabled
upload_command = avrdude -c avrispv2 -p attiny85 -P COM6 -b 19200 -U flash:w:$SOURCE:i -U lfuse:w:0xE2:m -U hfuse:w:0x5F:m -U efuse:w:0xFF:m

; ============================================================================
; RELEASE BUILD OLD HW - Production firmware for old hardware revision
; ============================================================================

[env:attiny85_release_old]
; ⚠️  WARNING: PRODUCTION BUILD - RESET PIN DISABLED! ⚠️ 
; Programming via ISP will NOT be possible after flashing!
; OLD HARDWARE: PB5=BUZZER, PB3=MIC, LED_3ER disabled due to reset pin usage
platform = atmelavr
board = attiny85
board_build.f_cpu = 8000000L      ; 8MHz internal oscillator (ATtiny85)
build_type = release
build_flags = 
    -Os                           ; Optimize for size
    -Wall -Wextra                ; Enable all warnings
    -mmcu=attiny85               ; Target ATtiny85
    -std=c99                     ; C99 standard
    -ffunction-sections          ; Dead code elimination
    -fdata-sections              
    -Wl,--gc-sections            ; Linker garbage collection
    -flto                        ; Link-time optimization
    -Iconfig                     ; Include config directory
    -DPRODUCTION_BUILD           ; Production build flag
    -DPLATFORM_ATTINY85
    -DNDEBUG                     ; Disable debug assertions
    -DRESET_PIN_AS_IO            ; Use reset pin as GPIO
    -DOLD_HARDWARE_REVISION      ; Old HW: PB5=BUZZER, PB3=MIC, no LED_3ER
upload_protocol = avrispv2
upload_port = COM6
upload_speed = 19200
board_fuses.lfuse = 0xE2        ; Internal RC 8MHz, CKDIV8 disabled = 8MHz
board_fuses.hfuse = 0x5F        ; Reset DISABLED (0x5F), BOD 2.7V - ENABLES PB5 as GPIO!
board_fuses.efuse = 0xFF        ; Self-programming disabled
upload_command = avrdude -c avrispv2 -p attiny85 -P COM6 -b 19200 -U flash:w:$SOURCE:i -U lfuse:w:0xE2:m -U hfuse:w:0x5F:m -U efuse:w:0xFF:m

; Library dependencies
lib_deps = 
    ; No external libraries needed - using pure AVR C code